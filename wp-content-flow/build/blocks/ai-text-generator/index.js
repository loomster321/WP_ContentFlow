(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.blocks,o=window.wp.blockEditor,a=window.wp.components,l=window.wp.i18n,c=window.wp.data,r=window.wp.element,s=window.wp.apiFetch;var i=e.n(s);const w={name:"wp-content-flow/ai-text",title:(0,l.__)("AI Text Generator","wp-content-flow"),category:"text",icon:"admin-generic",description:(0,l.__)("Generate content using AI with customizable workflows and prompts.","wp-content-flow"),keywords:[(0,l.__)("ai","wp-content-flow"),(0,l.__)("content","wp-content-flow"),(0,l.__)("generate","wp-content-flow")],supports:{html:!1,anchor:!0,customClassName:!0,spacing:{margin:!0,padding:!0}},attributes:{content:{type:"string",default:""},workflowId:{type:"number",default:0},prompt:{type:"string",default:""},isGenerating:{type:"boolean",default:!1},lastGenerated:{type:"string",default:""},confidence:{type:"number",default:0}},edit:function({attributes:e,setAttributes:n,isSelected:s}){const{content:w,workflowId:p,prompt:d,isGenerating:m,confidence:f}=e,[_,u]=(0,r.useState)(""),[g,b]=(0,r.useState)({}),y=(0,c.useSelect)(e=>{const{getWorkflows:t}=e("wp-content-flow/workflows")||{};return t?t():[]},[]),{createNotice:k}=(0,c.useDispatch)("core/notices");(0,r.useEffect)(()=>{const e={};d.trim()||(e.prompt=(0,l.__)("Prompt is required","wp-content-flow")),p||(e.workflow=(0,l.__)("Please select a workflow","wp-content-flow")),b(e)},[d,p]);const E=async()=>{if(Object.keys(g).length>0)u((0,l.__)("Please fix the validation errors before generating content.","wp-content-flow"));else{n({isGenerating:!0}),u("");try{const e=await i()({path:"/wp-content-flow/v1/ai/generate",method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpContentFlow.nonce},data:{prompt:d,workflow_id:p,post_id:wp.data.select("core/editor")?.getCurrentPostId?.(),parameters:{max_tokens:1e3,temperature:.7}}});n({content:e.suggested_content,confidence:e.confidence_score,lastGenerated:(new Date).toISOString(),isGenerating:!1}),k("success",(0,l.__)("AI content generated successfully!","wp-content-flow"),{type:"snackbar",isDismissible:!0})}catch(e){let t=(0,l.__)("Failed to generate content. Please try again.","wp-content-flow");"rate_limit_exceeded"===e.code?t=(0,l.__)("Too many requests. Please try again later.","wp-content-flow"):"workflow_not_found"===e.code&&(t=(0,l.__)("Selected workflow not found. Please choose a different workflow.","wp-content-flow")),u(t),n({isGenerating:!1})}}},h=(0,o.useBlockProps)({className:"wp-content-flow-ai-text-generator"}),v=[{label:(0,l.__)("Select a workflow...","wp-content-flow"),value:0},...y.map(e=>({label:e.name,value:e.id}))];return(0,t.createElement)("div",{...h},(0,t.createElement)(o.BlockControls,null,(0,t.createElement)(a.ToolbarGroup,null,(0,t.createElement)(a.ToolbarButton,{icon:"controls-repeat",label:(0,l.__)("Regenerate","wp-content-flow"),onClick:()=>{w&&E()},disabled:m||!w}),(0,t.createElement)(a.ToolbarButton,{icon:"edit",label:(0,l.__)("Improve","wp-content-flow"),onClick:()=>(async()=>{if(w){n({isGenerating:!0}),u("");try{const e=await i()({path:"/wp-content-flow/v1/ai/improve",method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpContentFlow.nonce},data:{content:w,workflow_id:p,improvement_type:"style"}});e.length>0&&(n({content:e[0].suggested_content,confidence:e[0].confidence_score,isGenerating:!1}),k("success",(0,l.__)("Content improved successfully!","wp-content-flow"),{type:"snackbar",isDismissible:!0}))}catch(e){u((0,l.__)("Failed to improve content. Please try again.","wp-content-flow")),n({isGenerating:!1})}}})(),disabled:m||!w}))),(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(a.PanelBody,{title:(0,l.__)("AI Settings","wp-content-flow"),initialOpen:!0},(0,t.createElement)(a.SelectControl,{label:(0,l.__)("Workflow","wp-content-flow"),value:p,options:v,onChange:e=>n({workflowId:parseInt(e)}),help:g.workflow}),p>0&&(0,t.createElement)(a.TextareaControl,{label:(0,l.__)("Content Prompt","wp-content-flow"),value:d,onChange:e=>n({prompt:e}),placeholder:(0,l.__)("Enter your content prompt...","wp-content-flow"),rows:4,help:g.prompt||(0,l.__)("Describe what content you want to generate.","wp-content-flow")})),f>0&&(0,t.createElement)(a.PanelBody,{title:(0,l.__)("Parameters","wp-content-flow"),initialOpen:!1},(0,t.createElement)("p",null,(0,t.createElement)("strong",null,(0,l.__)("Confidence Score:","wp-content-flow"))," ",Math.round(100*f),"%"),f<.7&&(0,t.createElement)(a.Notice,{status:"warning",isDismissible:!1},(0,l.__)("Low confidence score. Consider regenerating with a more specific prompt.","wp-content-flow")))),(0,t.createElement)("div",{className:"wp-content-flow-ai-block-content"},_&&(0,t.createElement)(a.Notice,{status:"error",isDismissible:!0,onRemove:()=>u("")},_),Object.keys(g).length>0&&s&&(0,t.createElement)(a.Notice,{status:"warning",isDismissible:!1},Object.values(g).join(", ")),m?(0,t.createElement)("div",{className:"wp-content-flow-generating"},(0,t.createElement)(a.Spinner,null),(0,t.createElement)("p",null,(0,l.__)("Generating AI content...","wp-content-flow"))):(0,t.createElement)(t.Fragment,null,w?(0,t.createElement)("div",{className:"wp-content-flow-generated-content"},(0,t.createElement)("div",{className:"content-display",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:e=>n({content:e.target.textContent}),dangerouslySetInnerHTML:{__html:w}}),f>0&&(0,t.createElement)("div",{className:"confidence-indicator"},(0,t.createElement)("small",null,(0,l.__)("Confidence:","wp-content-flow")," ",Math.round(100*f),"%"))):(0,t.createElement)("div",{className:"wp-content-flow-placeholder"},p&&d?(0,t.createElement)(a.Button,{variant:"primary",onClick:E,disabled:Object.keys(g).length>0},(0,l.__)("Generate Content","wp-content-flow")):(0,t.createElement)("p",{className:"placeholder-text"},(0,l.__)("Select a workflow and enter a prompt to generate AI content.","wp-content-flow"))))))},save:function({attributes:e}){const{content:n}=e,a=o.useBlockProps.save();return(0,t.createElement)("div",{...a},n&&(0,t.createElement)("div",{className:"wp-content-flow-ai-generated-content",dangerouslySetInnerHTML:{__html:n}}))}};(0,n.registerBlockType)(w.name,w)})();