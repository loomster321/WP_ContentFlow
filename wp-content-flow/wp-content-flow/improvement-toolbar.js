(()=>{"use strict";var e={87:e=>{e.exports=window.wp.element},143:e=>{e.exports=window.wp.data},427:e=>{e.exports=window.wp.components},455:e=>{e.exports=window.wp.apiFetch},723:e=>{e.exports=window.wp.i18n}},t={};function n(o){var l=t[o];if(void 0!==l)return l.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=n(723),l=n(427),a=n(87),s=n(143);window.wp.richText;var c=n(455),r=n.n(c);function i(){const[e,t]=(0,a.useState)(!1),[n,c]=(0,a.useState)(""),[i,m]=(0,a.useState)(null),[d,w]=(0,a.useState)([]),[p,u]=(0,a.useState)(!1),[g,f]=(0,a.useState)(""),v=(0,s.useSelect)(e=>{const t=e("wp-content-flow/workflows");return t?t.getActiveWorkflows():[]},[]),{createNotice:E}=(0,s.useDispatch)("core/notices");(0,a.useEffect)(()=>{const e=()=>{const e=window.getSelection();if(e.rangeCount>0&&!e.isCollapsed){const n=e.getRangeAt(0),o=e.toString().trim();o.length>10&&_(n)?(c(o),m(n),t(!0)):h()}else h()};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}},[]);const _=e=>{const t=e.commonAncestorContainer,n=t.ownerDocument?.querySelector(".block-editor-writing-flow");return n&&n.contains(t)},h=()=>{t(!1),c(""),m(null),w([]),f("")},y=async e=>{if(n&&0!==v.length){u(!0),f(""),w([]);try{const t=v[0].id,o=await r()({path:"/wp-content-flow/v1/ai/improve",method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpContentFlow.nonce},data:{content:n,workflow_id:t,improvement_type:e}});w(o)}catch(e){f((0,o.__)("Failed to get AI suggestions. Please try again.","wp-content-flow"))}finally{u(!1)}}};if(!e||!i)return null;const b=(()=>{if(!i)return null;const e=i.getBoundingClientRect();return{x:e.left+e.width/2,y:e.top-10}})();return(0,a.createElement)(l.Popover,{position:"top center",anchorRef:{getBoundingClientRect:()=>({x:b.x,y:b.y,width:0,height:0,top:b.y,right:b.x,bottom:b.y,left:b.x})},onClose:h,className:"wp-content-flow-improvement-toolbar"},(0,a.createElement)("div",{className:"improvement-toolbar-content"},g&&(0,a.createElement)("div",{className:"toolbar-error"},(0,a.createElement)("span",null,g),(0,a.createElement)(l.Button,{size:"small",onClick:()=>f("")},"âœ•")),d.length>0?(0,a.createElement)("div",{className:"suggestions-list"},(0,a.createElement)("div",{className:"suggestions-header"},(0,a.createElement)("strong",null,(0,o.__)("AI Suggestions:","wp-content-flow"))),d.map((e,t)=>(0,a.createElement)("div",{key:t,className:"suggestion-item"},(0,a.createElement)("div",{className:"suggestion-content"},e.suggested_content),(0,a.createElement)("div",{className:"suggestion-actions"},(0,a.createElement)(l.Button,{size:"small",variant:"primary",onClick:()=>(e=>{if(i&&e.suggested_content)try{i.deleteContents();const t=document.createTextNode(e.suggested_content);i.insertNode(t),window.getSelection().removeAllRanges(),h(),E("success",(0,o.__)("Text improved successfully!","wp-content-flow"),{type:"snackbar",isDismissible:!0})}catch(e){f((0,o.__)("Failed to apply suggestion. Please try manually.","wp-content-flow"))}})(e)},"âœ“"," ",(0,o.__)("Apply","wp-content-flow")),(0,a.createElement)("span",{className:"confidence-score"},Math.round(100*e.confidence_score),"%"))))):p?(0,a.createElement)("div",{className:"toolbar-loading"},(0,a.createElement)(l.Spinner,null),(0,a.createElement)("span",null,(0,o.__)("Getting AI suggestions...","wp-content-flow"))):(0,a.createElement)("div",{className:"improvement-options"},(0,a.createElement)("div",{className:"toolbar-header"},(0,a.createElement)("span",null,"ðŸ§ "," ",(0,o.__)("Improve with AI","wp-content-flow"))),(0,a.createElement)(l.ButtonGroup,null,(0,a.createElement)(l.Button,{size:"small",onClick:()=>y("grammar"),disabled:0===v.length},(0,o.__)("Grammar","wp-content-flow")),(0,a.createElement)(l.Button,{size:"small",onClick:()=>y("style"),disabled:0===v.length},(0,o.__)("Style","wp-content-flow")),(0,a.createElement)(l.Button,{size:"small",onClick:()=>y("clarity"),disabled:0===v.length},(0,o.__)("Clarity","wp-content-flow")),(0,a.createElement)(l.Button,{size:"small",onClick:()=>y("engagement"),disabled:0===v.length},(0,o.__)("Engagement","wp-content-flow")),(0,a.createElement)(l.Button,{size:"small",onClick:()=>y("seo"),disabled:0===v.length},(0,o.__)("SEO","wp-content-flow"))),0===v.length&&(0,a.createElement)("div",{className:"no-workflows-notice"},(0,o.__)("No active workflows found. Please create a workflow first.","wp-content-flow")))))}document.addEventListener("DOMContentLoaded",()=>{if(document.querySelector(".block-editor-page")){const e=document.createElement("div");e.id="wp-content-flow-improvement-toolbar",document.body.appendChild(e),(0,a.render)((0,a.createElement)(i),e)}})})();