!function(t){"use strict";function e(){console.log("Checking for admin messages...");var e=t(".notice, .updated, .error, .settings-error");console.log("Total admin notices found:",e.length);var n=t(".notice-success, .updated, .settings-error-settings_updated"),o=t(".notice-error, .error"),i=t(".notice-warning");n.length>0&&(console.log("✅ Success notices found:",n.length),n.each(function(e){var n=t(this).text().trim();console.log(`Success notice ${e+1}:`,n)})),o.length>0&&(console.log("❌ Error notices found:",o.length),o.each(function(e){var n=t(this).text().trim();console.log(`Error notice ${e+1}:`,n)})),i.length>0&&(console.log("⚠️ Warning notices found:",i.length),i.each(function(e){var n=t(this).text().trim();console.log(`Warning notice ${e+1}:`,n)})),0===e.length&&console.log("No admin notices found on the page");var s=e.filter(function(){return t(this).text().toLowerCase().includes("content flow")||t(this).text().toLowerCase().includes("settings saved")});s.length>0&&(console.log("🎯 WP Content Flow specific notices found:",s.length),s.each(function(e){console.log(`WP Content Flow notice ${e+1}:`,t(this).text().trim())}))}function n(){var e=t(this),n=e.data("provider"),o=t("#"+n+"-status");e.prop("disabled",!0).text("Testing..."),o.html('<span class="testing">Testing connection...</span>'),t.ajax({url:wpContentFlow.ajaxUrl,type:"POST",data:{action:"wp_content_flow_test_connection",provider:n,nonce:wpContentFlow.nonce},success:function(t){t.success?o.html('<span class="success" style="color: green;">✓ Connected successfully</span>'):o.html('<span class="error" style="color: red;">✗ Connection failed: '+t.data+"</span>")},error:function(t,e,n){o.html('<span class="error" style="color: red;">✗ Connection error: '+n+"</span>")},complete:function(){e.prop("disabled",!1).text("Test "+n.charAt(0).toUpperCase()+n.slice(1)+" Connection")}})}function o(){var e=t(this),n=e.data("workflow-id"),o=t('.workflow-status[data-workflow-id="'+n+'"]');e.prop("disabled",!0).text("Executing..."),o.text("Running..."),t.ajax({url:wpContentFlow.ajaxUrl,type:"POST",data:{action:"wp_content_flow_execute_workflow",workflow_id:n,nonce:wpContentFlow.nonce},success:function(t){t.success?(o.text("Completed successfully"),e.text("Execute Again")):(o.text("Failed: "+t.data),e.text("Retry Execution"))},error:function(t,n,i){o.text("Error: "+i),e.text("Retry Execution")},complete:function(){e.prop("disabled",!1)}})}function i(){var e=t(this),n=e.data("suggestion-id");confirm("Are you sure you want to apply this suggestion?")&&(e.prop("disabled",!0).text("Applying..."),t.ajax({url:wpContentFlow.ajaxUrl,type:"POST",data:{action:"wp_content_flow_apply_suggestion",suggestion_id:n,nonce:wpContentFlow.nonce},success:function(t){t.success?(e.closest(".suggestion-item").addClass("applied"),e.text("Applied").prop("disabled",!0),s("Suggestion applied successfully!","success")):(e.text("Apply Suggestion").prop("disabled",!1),s("Failed to apply suggestion: "+t.data,"error"))},error:function(t,n,o){e.text("Apply Suggestion").prop("disabled",!1),s("Error applying suggestion: "+o,"error")}}))}function s(e,n){var o=t('<div class="notice notice-'+(n=n||"info")+' is-dismissible"><p>'+e+"</p></div>");t(".wrap h1").after(o),setTimeout(function(){o.fadeOut(function(){t(this).remove()})},5e3)}t(document).ready(function(){t(".test-connection").on("click",n),t(".execute-workflow").on("click",o),t(".apply-suggestion").on("click",i),console.log("Initializing WP Content Flow settings debugging..."),t(document).on("submit","#wp-content-flow-settings-form",function(e){console.log("WP Content Flow Settings form submission detected");var n=t(this),o=n.serializeArray();console.log("Settings form data:",o);var i=!1,a=["wp_content_flow_settings[openai_api_key]","wp_content_flow_settings[anthropic_api_key]","wp_content_flow_settings[google_api_key]"];o.forEach(function(t){a.includes(t.name)&&""!==t.value.trim()&&(i=!0,console.log("Found API key for:",t.name))});var c=n.find('input[name="option_page"]').val(),r=n.find('input[name="_wpnonce"]').val();if(console.log("Form validation:",{optionPage:c,noncePresent:!!r,hasApiKey:i,formAction:n.attr("action"),formMethod:n.attr("method")}),!c||!r)return console.error("Missing required security fields"),s("Form security validation failed. Please refresh and try again.","error"),e.preventDefault(),!1;var l=t("#wp-content-flow-submit-btn");if(0===l.length&&(l=n.find('input[type="submit"]')),l.length>0){var p=l.val();l.val("Saving Settings...").prop("disabled",!0),setTimeout(function(){l.val(p).prop("disabled",!1)},15e3)}return console.log("Form validation passed, submitting..."),!0}),t("form").on("submit",function(e){var n=t(this);if(n.find('input[name="option_page"]').length>0&&!n.is("#wp-content-flow-settings-form")){console.log("Generic WordPress settings form submission detected");var o=n.find('input[name="option_page"]').val();if(console.log("Generic form option_page:",o),o&&o.includes("wp_content_flow")){console.log("This appears to be a WP Content Flow form without proper ID");var i=n.serializeArray();console.log("Generic WP Content Flow form data:",i)}}}),setTimeout(function(){e()},500),(window.location.search.includes("settings-updated=true")||window.location.search.includes("wp-content-flow-settings"))&&(console.log("Settings page loaded with potential update"),setTimeout(e,1e3)),console.log("WP Content Flow admin initialized")}),(window.location.pathname.includes("post.php")||window.location.pathname.includes("post-new.php"))&&t(window).on("load",function(){"undefined"!=typeof wp&&wp.data&&wp.data.subscribe(function(){var e,n=wp.data.select("core/block-editor").getSelectedBlock();n&&"wp-content-flow/ai-text-generator"===n.name&&(e=n,console.log("AI Text Generator block selected:",e),t(document).on("click",".wp-content-flow-generate-btn",function(){var n,o;n=t(this).closest(".wp-content-flow-block").find(".prompt-input").val(),o=function(t){wp.data.dispatch("core/block-editor").updateBlock(e.clientId,{attributes:{...e.attributes,generatedContent:t}})},n&&""!==n.trim()?t.ajax({url:wpContentFlow.restUrl+"generate",type:"POST",headers:{"X-WP-Nonce":wpContentFlow.restNonce},data:JSON.stringify({prompt:n,max_tokens:1500,temperature:.7}),contentType:"application/json",success:function(t){t.content?(o(t.content),s("Content generated successfully!","success")):s("No content was generated. Please try again.","warning")},error:function(t,e,n){s("Error generating content: "+n,"error")}}):s("Please enter a prompt for content generation.","warning")}))})})}(jQuery);